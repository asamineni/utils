#!/bin/bash

# Replace <your_bootstrap_servers> with your Kafka bootstrap servers
BOOTSTRAP_SERVERS="localhost:9092"

# Get the list of topics
TOPICS=$(bin/kafka-topics.sh --bootstrap-server "$BOOTSTRAP_SERVERS" --list)

# Iterate through each topic
for TOPIC in $TOPICS; do
  # Describe the topic
  DESCRIPTION=$(bin/kafka-topics.sh --bootstrap-server "$BOOTSTRAP_SERVERS" --describe --topic "$TOPIC" 2>/dev/null) #added 2>/dev/null to discard errors.

  # Extract the replication factor using a more robust method
  REPLICATION_FACTOR=$(echo "$DESCRIPTION" | grep -oP "ReplicationFactor: \K\d+")

  # Check if the replication factor is a number and greater than 3
  if [[ -n "$REPLICATION_FACTOR" ]] && [[ "$REPLICATION_FACTOR" -gt 3 ]]; then
    echo "Topic: $TOPIC, Replication Factor: $REPLICATION_FACTOR"
  fi
done
